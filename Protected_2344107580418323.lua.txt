local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

local ANIMATION_ID = "100203839720961" 

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AnimationGUI"
screenGui.ResetOnSpawn = false  
screenGui.Parent = player.PlayerGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 100)
mainFrame.Position = UDim2.new(0, 10, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30) -- Changé en gris foncé
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

local title = Instance.new("Frame")
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundColor3 = Color3.fromRGB(20, 20, 20) -- Changé en noir/gris très foncé
title.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 8)
titleCorner.Parent = title

local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(0.8, 0, 1, 0)
titleText.Position = UDim2.new(0, 5, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "Invisible | Omega" -- Texte changé
titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
titleText.Font = Enum.Font.GothamBold
titleText.TextSize = 14
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = title

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 25, 0, 25)
closeButton.Position = UDim2.new(1, -30, 0.5, -12)
closeButton.BackgroundColor3 = Color3.fromRGB(255, 140, 0) -- Changé en orange
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.Parent = title

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 4)
closeCorner.Parent = closeButton

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 120, 0, 40)
toggleButton.Position = UDim2.new(0.5, -60, 0.5, -20)
toggleButton.BackgroundColor3 = Color3.fromRGB(200, 80, 0) -- Changé en orange (état OFF)
toggleButton.Text = "OFF"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 16
toggleButton.Parent = mainFrame

local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 6)
buttonCorner.Parent = toggleButton

local animationTrack
local isPlaying = false
local humanoid
local originalTransparency = {}

local function makeTransparent()
    if not character then return end
    
    for _, part in pairs(character:GetChildren()) do
        if part:IsA("BasePart") then
            originalTransparency[part] = part.Transparency
            part.Transparency = 0.4
        end
    end
end

local function makeVisible()
    if not character then return end
    
    for part, transparency in pairs(originalTransparency) do
        if part and part.Parent then
            part.Transparency = transparency
        end
    end
    originalTransparency = {}
end

local function loadAnimation()
    if not character then return end
    
    humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end
    
    local animation = Instance.new("Animation")
    animation.AnimationId = "rbxassetid://" .. ANIMATION_ID
    
    animationTrack = humanoid:LoadAnimation(animation)
end

local function stopAnimation()
    if animationTrack then
        animationTrack:Stop()
    end
    makeVisible()
    isPlaying = false
    toggleButton.BackgroundColor3 = Color3.fromRGB(200, 80, 0) -- Changé en orange (état OFF)
    toggleButton.Text = "OFF"
end

player.CharacterAdded:Connect(function(newChar)
    character = newChar
    wait(1)
    loadAnimation()
    stopAnimation()
end)

player.CharacterRemoving:Connect(function()
    stopAnimation()
end)

loadAnimation()

local function toggleAnimation()
    if not animationTrack then
        loadAnimation()
        if not animationTrack then return end
    end
    
    if isPlaying then
        animationTrack:Stop()
        makeVisible()
        toggleButton.BackgroundColor3 = Color3.fromRGB(200, 80, 0) -- Changé en orange (état OFF)
        toggleButton.Text = "OFF"
        isPlaying = false
    else
        animationTrack:Play()
        animationTrack:AdjustSpeed(100) 
        makeTransparent()
        toggleButton.BackgroundColor3 = Color3.fromRGB(255, 140, 0) -- Changé en orange vif (état ON)
        toggleButton.Text = "ON"
        isPlaying = true
    end
end

toggleButton.MouseButton1Click:Connect(toggleAnimation)

closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(
        startPos.X.Scale, 
        startPos.X.Offset + delta.X, 
        startPos.Y.Scale, 
        startPos.Y.Offset + delta.Y
    )
end

local function onInputBegan(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or 
       input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        title.BackgroundColor3 = Color3.fromRGB(50, 50, 100) -- Gardé en bleu pour le drag
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                title.BackgroundColor3 = Color3.fromRGB(20, 20, 20) -- Retour au noir/gris
            end
        end)
    end
end

local function onInputChanged(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or 
       input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end

title.InputBegan:Connect(onInputBegan)
title.InputChanged:Connect(onInputChanged)
mainFrame.InputBegan:Connect(onInputBegan)
mainFrame.InputChanged:Connect(onInputChanged)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)
